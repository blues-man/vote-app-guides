<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Workshop Development - Pipelines :: OpenShift Inner &amp; Outer Loop Development Guides</title>
    <link rel="prev" href="intro.html">
    <link rel="next" href="argocd.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('USERID');
      const subDomain = urlParams.get('SUBDOMAIN');
      const apiUrl = urlParams.get('APIURL');
      if (userId) {
        showUserId( userId );
      }
      else {
        showUserIdForm();
      }
    } );


    function showUserId( userId ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('username').textContent = userId;
      document.getElementById('subDomain').value = subDomain;
      document.getElementById('apiUrl').value = apiUrl;

    }

    function showUserIdForm( userId ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function goWithUserId() {
      elUserIdInput = document.getElementById('userId');
      elSubDomainInput = document.getElementById('subDomain');
      elapiUrlInput = document.getElementById('apiUrl');

      window.location.search = ('&USERID=' + elUserIdInput.value + '&SUBDOMAIN=' + elSubDomainInput.value + '&APIURL=' + elapiUrlInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift" target="_blank"><img
          src="../../../_/img/Logo-Red_Hat-OpenShift_4-A-Reverse-RGB.png" height="40px" alt="Red Hat OpenShift"></a>
      <a class="navbar-item" href="../../.." style="color: white;"><h3>OpenShift Inner &amp; Outer Loop Development Guides</h3></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem;">Your Workshop Environment</span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="goWithUserId();">
            <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
              <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
            </div>
            <input size="40" id="userId" type="text" placeholder="Enter USER ID">
            <input type="hidden" id="subDomain" name="subDomain" value="">
            <input type="hidden" id="apiUrl" name="apiUrl" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem;">Your Workshop Environment</span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="username"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="inner-outer-guides" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../m1/intro.html" class=" query-params-link">Inner &amp; Outer Development Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module One: Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m1/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m1/inner-outer.html">Inner vs Outer Loop</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m1/setup.html">Lab Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module Two: Development</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="intro.html">Introduction</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="pipelines.html">Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="argocd.html">Argo CD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devspaces.html">Dev Spaces</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="finish.html">Finish</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module Three: Production</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m3/production.html">Pushing to Production</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Module Four: Conclusion</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m4/finish.html">Finish</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../m4/resources.html">Resources</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Inner &amp; Outer Development Guides</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Inner & Outer Development Guides</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../m1/intro.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../m1/intro.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../m1/intro.html">Inner & Outer Development Guides</a></li>
    <li>Module Two: Development</li>
    <li><a href="pipelines.html">Pipelines</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/inner-outer-tutorial/edit/main/docs/modules/m2/pages/pipelines.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Workshop Development - Pipelines</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will learn how to use a Tekton pipeline resource and trigger the Pipeline to run. The Pipeline will first clone the git repository source code of the <code>vote-api</code> and <code>vote-ui</code> repositories. The Pipeline will then build the application and push the image to the internal image registry. We&#8217;ll also later add a webhook to the <code>vote-ui</code> to trigger when a commit is made to the Git repository. Finally, the Pipeline will update the deployment in the <code>vote-app-gitops</code> repository with the new image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_viewing_the_pipelines"><a class="anchor" href="#_viewing_the_pipelines"></a>Viewing the pipelines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s use the OpenShift Console to view the pipelines created for you. Within the <strong>Developer</strong> perspective of the OpenShift Console, click on the <strong>Pipelines</strong> link in the left navigation menu. You can also use <a href="https://console-openshift-console.%SUBDOMAIN%/dev-pipelines/all-namespaces" class="params-link" target="_blank" rel="noopener"><strong>this link</strong></a> to head to the Pipelines page directly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/switch-perspective.png" alt="switch perspective">
</div>
</div>
<div class="paragraph">
<p>Here, we will select the <code>vote-app-ci-%USERID%</code> project, where the pipelines have been created. This section details all the pipelines we&#8217;ll be using in the workshop, details about the last pipeline run, the status of the tasks, and more relevant details about the Pipeline. You should see three pipelines, <code>promote-to-prod</code>, <code>vote-app-api-pipeline</code>, and <code>vote-app-ui-pipeline</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipelines-default.png" alt="pipelines default">
</div>
</div>
<div class="paragraph">
<p>Before we start the pipelines, let&#8217;s look at one of the pipeline contents. Click on the <code>vote-app-api-pipeline</code> pipeline to view the pipeline details. Select <strong>YAML</strong> to view the pipeline definition in <a href="https://www.redhat.com/en/topics/automation/what-is-yaml" target="_blank" rel="noopener"><strong>YAML format</strong></a>. You should see the pipeline definition, along with the tasks that are defined in the Pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-yaml.png" alt="pipeline yaml">
</div>
</div>
<div class="paragraph">
<p>This Pipeline YAML defines the tasks to be run in the Pipeline and also defines the parameters used in the Pipeline, such as the git repository URL, the image name, and more.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-yaml-content.png" alt="pipeline yaml content">
</div>
</div>
<div class="paragraph">
<p>We can also view the pipeline content below. The last YAML definition is a task that helps to bundle multiple actions together, including cloning the git repository, updating image digests, and committing changes.</p>
</div>
<div class="paragraph">
<p><strong>vote-app-api-pipeline</strong></p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: vote-app-api-pipeline
  namespace: vote-app-ci-%USERID%
spec:
  params:
  - name: SOURCE_GIT_URL
    type: string
    description: The application git repository url
    default: 'http://gitea.gitea.svc:3000/%USERID%/pipelines-vote-api'
  - name: SOURCE_GIT_REVISION
    type: string
    default: master
    description: The application git repository revision
  - default: image-registry.openshift-image-registry.svc:5000/vote-app-dev-%USERID%/vote-api
    name: IMAGE_NAME
    type: string
  - default: .
    name: PATH_CONTEXT
    type: string
  - default: 'http://gitea.gitea.svc:3000/%USERID%/vote-app-gitops'
    name: CONFIG_GIT_REPO
    type: string
  - default: main
    name: CONFIG_GIT_REVISION
    type: string

  workspaces:
  - name: app-source

  tasks:

  - name: git-clone
    taskRef:
      kind: ClusterTask
      name: git-clone
    params:
    - name: url
      value: $(params.SOURCE_GIT_URL)
    - name: revision
      value: $(params.SOURCE_GIT_REVISION)
    - name: deleteExisting
      value: 'true'
    workspaces:
    - name: output
      workspace: app-source

  - name: build-and-push
    params:
    - name: IMAGE
      value: $(params.IMAGE_NAME)
    - name: TLSVERIFY
      value: "false"
    - name: CONTEXT
      value: $(params.PATH_CONTEXT)
    runAfter:
    - git-clone
    taskRef:
      kind: ClusterTask
      name: buildah
    workspaces:
    - name: source
      workspace: app-source

  - name: git-update-deployment
    params:
    - name: GIT_REPOSITORY
      value: $(params.CONFIG_GIT_REPO)
    - name: CURRENT_IMAGE
      value: quay.io/bluesman/vote-api:latest
    - name: NEW_IMAGE
      value: $(params.IMAGE_NAME)
    - name: NEW_DIGEST
      value: $(tasks.build-and-push.results.IMAGE_DIGEST)
    - name: KUSTOMIZATION_PATH
      value: environments/dev
    - name: GIT_REF
      value: $(params.CONFIG_GIT_REVISION)
    runAfter:
      - build-and-push
    taskRef:
      kind: Task
      name: git-update-deployment
    workspaces:
    - name: workspace
      workspace: app-source</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>vote-app-ui-pipeline</strong></p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: vote-app-ui-pipeline
  namespace: vote-app-ci-%USERID%
spec:
  params:
  - name: SOURCE_GIT_URL
    type: string
    description: The application git repository url
    default: 'http://gitea.gitea.svc:3000/%USERID%/pipelines-vote-ui'
  - name: SOURCE_GIT_REVISION
    type: string
    default: master
    description: The application git repository revision
  - default: image-registry.openshift-image-registry.svc:5000/vote-app-dev-%USERID%/vote-ui
    name: IMAGE_NAME
    type: string
  - default: .
    name: PATH_CONTEXT
    type: string
  - default: 'http://gitea.gitea.svc:3000/%USERID%/vote-app-gitops'
    name: CONFIG_GIT_REPO
    type: string
  - default: main
    name: CONFIG_GIT_REVISION
    type: string

  workspaces:
  - name: app-source

  tasks:

  - name: git-clone
    taskRef:
      kind: ClusterTask
      name: git-clone
    params:
    - name: url
      value: $(params.SOURCE_GIT_URL)
    - name: revision
      value: $(params.SOURCE_GIT_REVISION)
    - name: deleteExisting
      value: 'true'
    workspaces:
    - name: output
      workspace: app-source

  - name: build-and-push
    params:
    - name: IMAGE
      value: $(params.IMAGE_NAME)
    - name: TLSVERIFY
      value: "false"
    - name: CONTEXT
      value: $(params.PATH_CONTEXT)
    runAfter:
    - git-clone
    taskRef:
      kind: ClusterTask
      name: buildah
    workspaces:
    - name: source
      workspace: app-source

  - name: git-update-deployment
    params:
    - name: GIT_REPOSITORY
      value: $(params.CONFIG_GIT_REPO)
    - name: CURRENT_IMAGE
      value: quay.io/bluesman/vote-ui:latest
    - name: NEW_IMAGE
      value: $(params.IMAGE_NAME)
    - name: NEW_DIGEST
      value: $(tasks.build-and-push.results.IMAGE_DIGEST)
    - name: KUSTOMIZATION_PATH
      value: environments/dev
    - name: GIT_REF
      value: $(params.CONFIG_GIT_REVISION)
    runAfter:
      - build-and-push
    taskRef:
      kind: Task
      name: git-update-deployment
    workspaces:
    - name: workspace
      workspace: app-source</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>promote-to-prod</strong></p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: promote-to-prod
  namespace: vote-app-ci-%USERID%
spec:
  params:
    - default: 'vote-app-dev-%USERID%/vote-ui:latest'
      name: SOURCE_IMAGE
      type: string
    - default: 'vote-app-prod-%USERID%/vote-ui:prod'
      name: DEST_IMAGE
      type: string
    - default: 'http://gitea.gitea.svc:3000/%USERID%/vote-app-gitops'
      name: CONFIG_GIT_REPO
      type: string
    - default: main
      name: CONFIG_GIT_REVISION
      type: string
    - default: &gt;-
        image-registry.openshift-image-registry.svc:5000/vote-app-prod-%USERID%/vote-ui
      name: IMAGE_NAME
      type: string
  tasks:
    - name: tag-to-prod
      params:
        - name: SCRIPT
          value: oc tag $(params.SOURCE_IMAGE) $(params.DEST_IMAGE)
        - name: VERSION
          value: latest
      taskRef:
        kind: ClusterTask
        name: openshift-client
    - name: image-tag-to-digest
      params:
        - name: image_dest_url
          value: $(params.IMAGE_NAME)
        - name: image_dest_tag
          value: prod
      runAfter:
        - tag-to-prod
      taskRef:
        kind: Task
        name: image-tag-to-digest
    - name: git-update-deployment
      params:
        - name: GIT_REPOSITORY
          value: $(params.CONFIG_GIT_REPO)
        - name: GIT_REF
          value: $(params.CONFIG_GIT_REVISION)
        - name: CURRENT_IMAGE
          value: quay.io/bluesman/vote-ui:latest
        - name: NEW_IMAGE
          value: $(params.IMAGE_NAME)
        - name: NEW_DIGEST
          value: $(tasks.image-tag-to-digest.results.image_digest)
        - name: KUSTOMIZATION_PATH
          value: environments/prod
      runAfter:
        - image-tag-to-digest
      taskRef:
        kind: Task
        name: git-update-deployment
      workspaces:
        - name: workspace
          workspace: app-source
  workspaces:
    - name: app-source</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>git-update-deployment-task</strong></p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  annotations:
    tekton.dev/pipelines.minVersion: 0.12.1
    tekton.dev/tags: git
  name: git-update-deployment
  namespace: vote-app-ci-%USERID%
  labels:
    app.kubernetes.io/version: '0.2'
    operator.tekton.dev/provider-type: community
spec:
  description: &gt;-
    This Task can be used to update image digest in a Git repo using kustomize.
    It requires a secret with credentials for accessing the git repo.
  params:
    - name: GIT_REPOSITORY
      type: string
    - name: GIT_REF
      type: string
    - name: CURRENT_IMAGE
      type: string
    - name: NEW_IMAGE
      type: string
    - name: NEW_DIGEST
      type: string
    - name: KUSTOMIZATION_PATH
      type: string
  results:
    - description: The commit SHA
      name: commit
  steps:
    - image: 'docker.io/alpine/git:v2.26.2'
      name: git-clone
      resources: {}
      script: &gt;
        rm -rf git-update-digest-workdir

        git clone $(params.GIT_REPOSITORY) -b $(params.GIT_REF)
        git-update-digest-workdir
      workingDir: $(workspaces.workspace.path)
    - image: 'quay.io/wpernath/kustomize-ubi:latest'
      name: update-digest
      resources: {}
      script: &gt;
        cd git-update-digest-workdir/$(params.KUSTOMIZATION_PATH)

        kustomize edit set image
        $(params.CURRENT_IMAGE)=$(params.NEW_IMAGE)@$(params.NEW_DIGEST)


        echo "##########################"

        echo "### kustomization.yaml ###"

        echo "##########################"

        cat kustomization.yaml
      workingDir: $(workspaces.workspace.path)
    - image: 'docker.io/alpine/git:v2.26.2'
      name: git-commit
      resources: {}
      script: |
        cd git-update-digest-workdir

        git config user.email "tektonbot@redhat.com"
        git config user.name "My Tekton Bot"

        git status
        git add $(params.KUSTOMIZATION_PATH)/kustomization.yaml
        git commit -m "[ci] Image digest updated"

        git push

        RESULT_SHA="$(git rev-parse HEAD | tr -d '\n')"
        EXIT_CODE="$?"
        if [ "$EXIT_CODE" != 0 ]
        then
          exit $EXIT_CODE
        fi
        # Make sure we don't add a trailing newline to the result!
        echo -n "$RESULT_SHA" &gt; $(results.commit.path)
      workingDir: $(workspaces.workspace.path)
  workspaces:
    - description: The workspace consisting of maven project.
      name: workspace</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect1">
<h2 id="_starting_the_vote_app_api_pipeline"><a class="anchor" href="#_starting_the_vote_app_api_pipeline"></a>Starting the <code>vote-app-api</code> pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s start these pipelines by using a <a href="https://tekton.dev/docs/pipelines/pipelineruns/" target="_blank" rel="noopener">PipelineRun</a>, which is a custom resource that allows you to start a pipeline. This PipelineRun will start the <code>vote-app-api-pipeline</code> pipeline, which will build the <code>vote-api</code> image, and push it to the local registry. From the <strong>Pipelines</strong> view, select the <code>vote-app-api-pipeline</code> pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-list.png" alt="pipeline list">
</div>
</div>
<div class="paragraph">
<p>Here, you can review the pipeline steps and see what each step is doing. You can also see the pipeline resources that are being used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-details.png" alt="pipeline details">
</div>
</div>
<div class="paragraph">
<p>For reference, here are the pipeline steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>git-clone</code>: This step clones the local Git repository that contains the source code for the application. We&#8217;re able to do so because of a <code>gitea-gitops</code> secret that was created for you. This secret contains the username and password to access the Gitea repository.</p>
</li>
<li>
<p><code>build-and-push</code>: This step builds the image and pushes it to the internal OpenShift registry. The image name is passed in as a parameter.</p>
</li>
<li>
<p><code>git-update-deployment</code>: This final step updates the deployment manifests in the Git repository.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, let&#8217;s start the Pipeline. Click on the top-right <strong>Actions</strong> then <strong>Start</strong> button to start the Pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-start-button.png" alt="pipeline start button">
</div>
</div>
<div class="paragraph">
<p>You will be prompted to enter the values for the pipeline parameters, however the default values are already set for you. This includes the source Git repository, image name to build, and GitOps manifest repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-start-params.png" alt="pipeline start params">
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll still need to select a workspace, so scroll to the bottom of the form, select <strong>Persistent Volume Claim</strong>, and choose the <code>workspace-api-app-source</code> PVC. This <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/" target="_blank" rel="noopener">Persistent Volume Claim (PVC)</a> workspace gives us persistent storage that the Pipeline can access even in a containerized environment. Now, click on the <strong>Start</strong> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-start.png" alt="pipeline start">
</div>
</div>
<div class="paragraph">
<p>Now that the <code>vote-app-api</code> pipeline has been started, we can view it in action from the <strong>PipelineRuns</strong> view. We&#8217;ll need to wait for this first PipelineRun to finish before we can start the <code>vote-ui-app-pipeline</code> pipeline, which should take about 1-2 minutes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipelinerun-list-api.png" alt="pipelinerun list api">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_the_vote_app_ui_pipeline"><a class="anchor" href="#_starting_the_vote_app_ui_pipeline"></a>Starting the <code>vote-app-ui</code> pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the <code>vote-app-api-pipeline</code> PipelineRun completed, we can now start the <code>vote-ui-app-pipeline</code> pipeline. Let&#8217;s repeat the same steps for this other Pipeline, first selecting it from the <strong>Pipelines</strong> view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-ui-list-dashboard.png" alt="pipeline ui list dashboard">
</div>
</div>
<div class="paragraph">
<p>Here, we can go ahead and start the Pipeline. The tasks are essentially the same as the <code>vote-app-api</code>, so we can click the top-right <strong>Actions</strong> then <strong>Start</strong> button to start the Pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-ui-start.png" alt="pipeline ui start">
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that the only change here is the difference in the source Git repository and image name to build.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-ui-start-params.png" alt="pipeline ui start params">
</div>
</div>
<div class="paragraph">
<p>Although the default values are already set for you, you&#8217;ll still need to select a workspace, so select <strong>Persistent Volume Claim</strong> and choose the <code>workspace-ui-app-source</code> PVC. Now, click on the <strong>Start</strong> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipeline-ui-start-2.png" alt="pipeline ui start 2">
</div>
</div>
<div class="paragraph">
<p>Now that the <code>vote-app-ui</code> pipeline has been started, let&#8217;s go ahead and check the status of this Pipeline. We should be at the <strong>PipelineRuns</strong> view, and after a minute or two, the <code>vote-ui-app-pipeline</code> PipelineRun should be completed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipelinerun-finish-ui.png" alt="pipelinerun finish ui">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_checking_the_status_of_the_pipelines"><a class="anchor" href="#_checking_the_status_of_the_pipelines"></a>Checking the status of the pipelines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the <strong>PipelineRuns</strong> section, we can examine various details about the specific PipelineRun, such as the YAML executed, each TaskRun executed, parameters used for the PipelineRun, and logs from each Task.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipelinerun-status.png" alt="pipelinerun status">
</div>
</div>
<div class="paragraph">
<p>For example, viewing the logs from the <code>build-and-push</code> Task, we can see the output from the <em>build</em> and <em>push</em> actions, which use the <a href="https://buildah.io/" target="_blank" rel="noopener">Buildah</a> <code>bud</code> command.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pipelinerun-logs.png" alt="pipelinerun logs">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_checking_the_status_of_the_applications"><a class="anchor" href="#_checking_the_status_of_the_applications"></a>Checking the status of the applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the pipelines have been started let&#8217;s check the status of the deployments. Click on the <strong>Topology</strong> left-hand tab to see the list of deployments that have been created. We now have a new application called <strong>Triggers</strong> which contains two deployments, one for the <code>vote-api</code> and one for the <code>vote-ui</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/deployment-status.png" alt="deployment status">
</div>
</div>
<div class="paragraph">
<p>You can click on a deployment to see the details of the deployment, including the pods that are running, which is an event listener, allowing us to trigger a new build of the application when a change is made to the Git repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/deployment-details-el.png" alt="deployment details el">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_vote_ui_with_a_webhook"><a class="anchor" href="#_start_vote_ui_with_a_webhook"></a>Start <code>vote-ui</code> with a Webhook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tekton supports <a href="https://tekton.dev/docs/triggers/" target="_blank" rel="noopener">Triggers</a> to enable automation and webhooks. Now that the <code>vote-ui</code> deployment is running, let&#8217;s add a webhook to the Gitea repository to trigger a new build of the application when changes are made to the repository. From the <strong>Topology</strong> view, click on the <code>el-eventlistener-ui</code> deployment. From there, navigate to the <strong>Routes</strong> section and copy the <code>el-eventlistener-ui</code> Route URL from the bottom right-hand corner.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/trigger-vote-ui.png" alt="Trigger Vote UI">
</div>
</div>
<div class="paragraph">
<p>Once you have the URL copied to your clipboard, navigate to the <code>pipelines-vote-ui</code> code repository that you have on <a href="https://gitea.%SUBDOMAIN%/%USERID%/pipelines-vote-ui" class="params-link" target="_blank" rel="noopener"><strong>Gitea</strong></a>. From your repository page, click on the Settings menu in the top-right corner. From the top right-side menu, click on <strong>Settings</strong>, then <strong>Webhooks</strong>. Then, click on <strong>Add Webhook</strong> from the right-side menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/add-webhook.png" alt="Add Webhook">
</div>
</div>
<div class="paragraph">
<p>Paste the copied Route URL into the <strong>Target URL</strong> field in the next screen. You can leave the other fields blank; just ensure the Content Type is set to <code>application/json</code>. Finally, click on <strong>Add Webhook</strong> to create the webhook.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/create-webhook.png" alt="Create Webhook">
</div>
</div>
<div class="paragraph">
<p>Great, now we have a webhook that will trigger a new build of the application when changes are made to the Git repository. Later on in this module, we&#8217;ll make some changes to the source code using OpenShift Dev Spaces and push the changes to the Git repository to trigger a new build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Congratulations! You&#8217;ve successfully deployed the <code>vote-app</code> and <code>vote-api</code> pipelines using Tekton Pipelines. You&#8217;ve also added a webhook to the <code>vote-ui</code> pipeline to trigger a new build when changes are made to the Git repository. Now, let&#8217;s move on to the next lab to learn how to deploy the application using Argo CD.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="intro.html" class="query-params-link">Introduction</a></span>
  <span class="next"><a href="argocd.html" class="query-params-link">Argo CD</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<script src="../../../_/js/vendor/clipboard.js"></script>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
