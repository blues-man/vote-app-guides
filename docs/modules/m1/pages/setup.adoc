# Red Hat Summit 2023: Vote App Lab Overview - Setup

In this section, we'll take a look at the setup that this lab will be using. Before we begin, we can take a look at the developer flow that Red Hat Developer Tools provides.

.Developer Flow
image::developer-flow.png[Developer Flow]

Red Hat Developer Tools provides a set of tools that help developers to build, test, deploy, and run applications. These tools are integrated and work together to provide a seamless developer experience. The tools we'll be using in this lab are:

[tabs, subs="attributes+,+macros"]
====
Inner Loop: OpenShift Dev Spaces::
+
--
link:https://developers.redhat.com/products/openshift-dev-spaces/overview[*OpenShift Dev Spaces*] is a cloud and container-native development environment that provides a fast, secure, and zero-configuration development environment for Kubernetes and OpenShift. It allows developers to quickly bootstrap their development environment and start coding.

image::devspaces-interface.png[OpenShift Dev Spaces]
--
Outer Loop: OpenShift Pipelines::
+
--
link:https://catalog.redhat.com/software/container-stacks/detail/5ec54a4628834587a6b85ca5[*OpenShift Pipelines*] is a cloud-native, continuous integration and delivery (CI/CD) solution for building pipelines using Tekton. Tekton is a flexible, Kubernetes-native, open-source CI/CD framework that enables automating deployments across multiple platforms (Kubernetes, serverless, VMs, etc) by abstracting away the underlying implementation details.

image::pipeline-status.png[OpenShift Pipelines]
--
Outer Loop: OpenShift GitOps::
+
--
link:https://www.redhat.com/en/technologies/cloud-computing/openshift/gitops[*OpenShift GitOps*] OpenShift GitOps is a declarative application continuous delivery tool for Kubernetes based on ArgoCD project. Application definitions, configurations, and environments are declarative and version controlled in Git.

image::argocd-app-details-2.png[OpenShift GitOps]
--
====

NOTE: Everything has already been pre-installed on your cluster, so there's no need to do anything here. This is just for reference.

## Lab Architecture

To run this lab, we're using an OpenShift 4.12 cluster. This cluster has been pre-configured with the following:

### Operator: OpenShift Pipelines 
We'll be using link:https://console-openshift-console.%SUBDOMAIN%[*OpenShift Pipelines*] to pull our code from Gitea, build it, and update the Gitea repository with the new image tag. Follow these instructions in order to install OpenShift Pipelines on OpenShift via the OperatorHub:

- From the left-side menu under *Administrator* perspective, go to
*Operators*-> *OperatorHub*. In the search box, search for _OpenShift Pipelines_,
then click to *OpenShift Pipelines*:

.OperatorHub
image::prerequisites_operatorhub.png[OperatorHub]

- From the description view, click _Install_ to review all installation
settings.

.Install Pipelines
image::prerequisites_operatorhub_install_pipelines.png[Install
Pipelines]

- After few seconds, the installation should be completed with success and
you can verify it looking at _Status_ column, check if the status is
_Succeeded_.

### Operator: OpenShift GitOps 
We'll be using link:https://openshift-gitops-server-openshift-gitops.%SUBDOMAIN%[*OpenShift GitOps*] to deploy our application to the cluster, and to manage the application lifecycle. Our two projects, `vote-app-dev-%USERID%` and `vote-app-prod-%USERID%`, will be managed by ArgoCD, and we'll be able to demonstrate high-availability using GitOps. Follow these instructions in order to install OpenShift GitOps on OpenShift via the OperatorHub.

- From the left-side menu under *Administrator* perspective, go to
*Operators*-> *OperatorHub*. In the search box, search for _OpenShift GitOps_,
then click to *OpenShift GitOps*:

.OpenShift GitOps Operator
image::openshift-gitops-operator.png[OpenShift GitOps Operator]

- From the description view, click _Install_ to review all installation
settings.

.OpenShift GitOps operator
image::openshift-gitops-operator-install.png[OpenShift GitOps operator]

- After few seconds, the installation should be completed with success and
you can verify it looking at _Status_ column, check if the status is
_Succeeded_.

### Operator: OpenShift Dev Spaces
We'll use link:https://devspaces.%SUBDOMAIN%[*OpenShift Dev Spaces*] to develop our application locally, commit our changes using Git, and then deploy our changes to the cluster. Follow these instructions in order to install OpenShift Dev Spaces on OpenShift via the OperatorHub:

- From the left-side menu under *Administrator* perspective, go to
*Operators*-> *OperatorHub*. In the search box, search for _OpenShift Dev Spaces_,
then click to *OpenShift Dev Spaces*:

.OpenShift Dev Spaces Operator
image::openshift-devspaces-operator.png[OpenShift Dev Spaces Operator]

- From the description view, click _Install_ to review all installation
settings.

.OpenShift Dev Spaces Operator Install
image::openshift-devspaces-operator-install.png[OpenShift Dev Spaces operator]

- After few seconds, the installation should be completed with success and
you can verify it looking at _Status_ column, check if the status is
_Succeeded_.

### Operator: OpenShift Web Terminal
Finally, the *Web Terminal* is a web-based terminal for OpenShift. It allows users to access a terminal in a pod from the OpenShift Web Console. Follow these instructions in order to install OpenShift GitOps on OpenShift via the OperatorHub.

Log into OpenShift Web Console as a cluster admin and navigate to the
*Administrator* perspective and then *Operators* â†’ *OperatorHub*.

In the *OperatorHub*, search for _Web Terminal_ and follow the
operator install flow to install it.

.OpenShift Web Terminal
image::web-terminal-operator.png[OpenShift Web Terminal]

- From the description view, click _Install_ to review all installation
settings.

.OpenShift Web Terminal
image::web-terminal-operator-install.png[OpenShift Web Terminal]

- After few seconds, the installation should be completed with success and
you can verify it looking at _Status_ column, check if the status is
_Succeeded_.

## Lab Checks

### Argo CD

link:https://argocd-server-argocd-%USERID%.%SUBDOMAIN%[*Argo CD*] is a declarative, GitOps continuous delivery tool for Kubernetes provided in the OpenShift GitOps Operator. From your OpenShift cluster, you can access the ArgoCD dashboard.

image::argocd-button.png[ArgoCD]

You'll be able to access the ArgoCD UI via OpenShift using the following credentials:

- Username: `%USERID%`
- Password: `openshift`

You'll need to authorize the ArgoCD application to access your OpenShift cluster. Click on the *Allow selected permissions* button to authorize ArgoCD to access your OpenShift cluster. Finally, you'll be at the ArgoCD dashboard.

image::argocd.png[ArgoCD]

### Vote App Repository

You'll also have access to a link:http://gitea.%SUBDOMAIN%[*Gitea*] repository that contains the Vote App source code. This repository can also be located back at the *Lab Guides*, and you'll be able to access this repository using following credentials:

- Username: `%USERID%`
- Password: `openshift`

image::gitea.png[Gitea]

Once logged in, you can access the following Vote App source repositories:

- link:https://gitea.%SUBDOMAIN%/%USERID%/pipelines-vote-ui[Vote App UI Frontend]
- link:https://gitea.%SUBDOMAIN%/%USERID%/pipelines-vote-api[Vote App API Backend]

We also have a repository that contains the ArgoCD application manifests for the Vote App.

- link:https://gitea.%SUBDOMAIN%/%USERID%/vote-app-gitops[Vote App GitOps]

## Lab overview

Your cluster is already configured with the appropriate OpenShift project, configured secrets and service accounts, and necessary Git repositories. From here, we can wrap up the introduction and begin our lab!

// For Pipelines: Using gitea-gitops secret to login to the Gitea repository
// When you use 

// First user starts the pipeline, then deploys app in the dev namespace by using argoCD within argocd namespace or by using link from Lab Guides, user will login to argocd and create a new app `vote-app-dev-user`, sync automatic, no self heal, repository is vote-app-gitops on gitea, 

// Create pipeline, add webhook, create argo app, edit in devspaces locally then commit push, pipeline will redeploy, use promote to prod pipeline